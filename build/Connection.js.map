{"version":3,"sources":["../source/Connection.ts"],"names":[],"mappings":";;AAAA,iCAAqE;AACrE,6BAAmD;AAEnD,UAAU;AACV,mCAAsD;AAEtD;IAIC,yBAAY,OAA2B;QAF7B,wBAAmB,GAA6B,IAAI,sBAAe,CAAU,IAAI,CAAC,CAAC;QACnF,QAAG,GAAO,IAAI,CAAC;QAGxB,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;IACvB,CAAC;IAED,mCAAS,GAAT;QAEC,MAAM,CAAC,IAAI,CAAC,mBAAmB,CAAC,YAAY,EAAE,CAAC;IAChD,CAAC;IAED,iCAAO,GAAP,UAAQ,OAA2B;QAAnC,iBAeC;QAbA,IAAI,gBAAgB,GAAG,8BAAsB,CAAC,OAAO,CAAC,CAAC;QACvD,qBAAW,CAAC,OAAO,CAAC,gBAAgB,EAAE;YACrC,aAAa,EAAE,IAAI;SACnB,EAAE,UAAC,KAAiB,EAAE,EAAM;YAC5B,EAAE,CAAA,CAAC,KAAK,CAAC,CACT,CAAC;gBACA,KAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACpC,MAAM,KAAK,CAAC;YACb,CAAC;YAAA,IAAI,CAAA,CAAC;gBACL,KAAI,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;gBACnC,KAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACrC,CAAC;QACF,CAAC,CAAC,CAAA;IACH,CAAC;IAED,8BAA8B;IAC9B,+BAAK,GAAL,UAAM,UAA2B;QAA3B,2BAAA,EAAA,kBAA2B;QAEhC,EAAE,CAAA,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CACb,CAAC;YACA,MAAM,KAAK,CAAC,gBAAgB,CAAC,CAAC;QAC/B,CAAC;QACD,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;IACnC,CAAC;IACF,sBAAC;AAAD,CAxCA,AAwCC,IAAA;AAxCY,0CAAe;AAwC3B,CAAC","file":"Connection.js","sourcesContent":["import { CreateConnectionString, IConnectionOptions } from \"./Utils\";\nimport { Observable, BehaviorSubject } from \"rxjs\";\n\n// MongoDB\nimport { MongoClient, Db, MongoError } from \"mongodb\";\n\nexport class MongoConnection\n{\n\tprotected _OnConnectedSubject: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(null);\n\tprotected _db: Db = null;\n\tconstructor(options: IConnectionOptions)\n\t{\n\t\tthis.connect(options);\n\t}\n\n\tOnConnect(): Observable<boolean>\n\t{\n\t\treturn this._OnConnectedSubject.asObservable();\n\t}\n\n\tconnect(options: IConnectionOptions)\n\t{\n\t\tlet connectionString = CreateConnectionString(options);\n\t\tMongoClient.connect(connectionString, {\n\t\t\tautoReconnect: true,\n\t\t}, (error: MongoError, db: Db) => {\n\t\t\tif(error)\n\t\t\t{\n\t\t\t\tthis._OnConnectedSubject.next(null);\n\t\t\t\tthrow error;\n\t\t\t}else{\n\t\t\t\tthis._db = db.db(options.Database);\n\t\t\t\tthis._OnConnectedSubject.next(true);\n\t\t\t}\n\t\t})\n\t}\n\n\t// Closes the mongo connection\n\tclose(forceClose: boolean = false): Promise<void>\n\t{\n\t\tif(!this._db)\n\t\t{\n\t\t\tthrow Error(\"Not connected.\");\n\t\t}\n\t\treturn this._db.close(forceClose);\n\t}\n};"]}